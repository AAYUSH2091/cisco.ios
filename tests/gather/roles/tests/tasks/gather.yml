---
- name: Set expected facts for testing interface gathering
  ansible.builtin.set_fact:
    tests_expected_interfaces:
      - name: "GigabitEthernet0/0"
        description: "WAN Interface"
        ip_address: "192.168.1.1"
        subnet_mask: "255.255.255.0"
        status: "up"
        mac_address: "00:11:22:33:44:55"
      - name: "GigabitEthernet0/1"
        description: "LAN Interface"
        ip_address: "10.0.0.1"
        subnet_mask: "255.255.255.0"
        status: "up"
        mac_address: "00:11:22:33:44:66"

- name: Set test parameters
  ansible.builtin.set_fact:
    tests_item:
      name: "gather"
      vars:
        resources:
          - "interfaces"

- name: Run the gather role
  ansible.builtin.include_role:
    name: network.reports.gather
  vars:
    resources: "{{ tests_item.vars.resources }}"

- name: Verify interfaces data exists
  ansible.builtin.assert:
    that:
      - interfaces is defined
      - interfaces | type_debug == "list"
    fail_msg: "Interfaces data was not properly gathered"
    success_msg: "Interfaces data was successfully gathered"

- name: Verify each interface has required fields
  ansible.builtin.assert:
    that:
      - item.name is defined
      - item.name | type_debug == "str"
    loop: "{{ interfaces }}"
    loop_control:
      label: "{{ item.name | default('unnamed interface') }}"
